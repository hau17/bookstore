<div class="container py-4 px-3 px-md-4">
  <!-- Header Section -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3">
    <div>
      <h3 class="mb-2 fs-4 fs-md-3">
        <i class="bi bi-receipt"></i> Chi tiết đơn hàng 
        <span class="text-primary">#{{order.order_id}}</span>
      </h3>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item"><a href="/account/orders">Đơn hàng</a></li>
          <li class="breadcrumb-item active">#{{order.order_id}}</li>
        </ol>
      </nav>
    </div>
    
    <!-- Status Badge -->
    <span class="badge fs-5 px-3 py-2
      {{#if (eq order.status_id '1')}}bg-warning text-dark{{/if}}
      {{#if (eq order.status_id '2')}}bg-info{{/if}}
      {{#if (eq order.status_id '3')}}bg-primary{{/if}}
      {{#if (eq order.status_id '4')}}bg-success{{/if}}
      {{#if (eq order.status_id '5')}}bg-secondary{{/if}}
    ">
      {{#if (eq order.status_id '1')}}<i class="bi bi-clock-history"></i>{{/if}}
      {{#if (eq order.status_id '2')}}<i class="bi bi-box-seam"></i>{{/if}}
      {{#if (eq order.status_id '3')}}<i class="bi bi-truck"></i>{{/if}}
      {{#if (eq order.status_id '4')}}<i class="bi bi-check-circle-fill"></i>{{/if}}
      {{#if (eq order.status_id '5')}}<i class="bi bi-x-circle-fill"></i>{{/if}}
      {{order.status_name}}
    </span>
  </div>

  <div class="row g-4">
    <!-- Left Column: Order Info & Products -->
    <div class="col-12 col-lg-8">
      <!-- Order Information Card -->
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <i class="bi bi-info-circle"></i> Thông tin đơn hàng
          </h5>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-sm-6">
              <div class="info-item">
                <small class="text-muted d-block">Mã đơn hàng</small>
                <strong class="text-primary fs-5">#{{order.id}}</strong>
              </div>
            </div>
            <div class="col-12 col-sm-6">
              <div class="info-item">
                <small class="text-muted d-block">Ngày đặt hàng</small>
                <strong>
                  <i class="bi bi-calendar3"></i> {{formatDateTime order.created_at}}
                </strong>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Products Card -->
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">
            <i class="bi bi-bag-check"></i> Sản phẩm đã đặt
          </h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th scope="col" class="ps-3">Sản phẩm</th>
                  <th scope="col" class="text-center d-none d-md-table-cell">Số lượng</th>
                  <th scope="col" class="text-end d-none d-md-table-cell">Đơn giá</th>
                  <th scope="col" class="text-end pe-3">Thành tiền</th>
                </tr>
              </thead>
              <tbody>
                {{#each items}}
                  <tr>
                    <td class="ps-3">
                      <div class="fw-semibold">{{this.book_title}}</div>
                      <small class="text-muted d-md-none">
                        x{{this.quantity}} × {{formatPrice this.price}} ₫
                      </small>
                    </td>
                    <td class="text-center d-none d-md-table-cell">
                      <span class="badge bg-secondary">x{{this.quantity}}</span>
                    </td>
                    <td class="text-end d-none d-md-table-cell">
                      {{formatPrice this.price}} ₫
                    </td>
                    <td class="text-end pe-3">
                      <strong class="text-danger">{{formatPrice this.total_amount}} ₫</strong>
                    </td>
                  </tr>
                {{/each}}
              </tbody>
              <tfoot class="table-light">
                <tr>
                  <td colspan="3" class="text-end fw-bold pe-3">
                    <span class="fs-5">Tổng cộng:</span>
                  </td>
                  <td class="text-end pe-3">
                    <strong class="text-danger fs-4">
                      {{formatPrice order.total_amount}} ₫
                    </strong>
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column: Order History & Actions -->
    <div class="col-12 col-lg-4">
      <!-- Order History Card -->
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0">
            <i class="bi bi-clock-history"></i> Lịch sử trạng thái
          </h5>
        </div>
        <div class="card-body p-0">
          <div class="timeline">
            {{#each history}}
              <div class="timeline-item">
                <div class="timeline-marker 
                  {{#if (eq this.status_id 1)}}bg-warning{{/if}}
                  {{#if (eq this.status_id 2)}}bg-info{{/if}}
                  {{#if (eq this.status_id 3)}}bg-primary{{/if}}
                  {{#if (eq this.status_id 4)}}bg-success{{/if}}
                  {{#if (eq this.status_id 5)}}bg-secondary{{/if}}
                "></div>
                <div class="timeline-content">
                  <h6 class="mb-1">{{this.status_name}}</h6>
                  <small class="text-muted">
                    <i class="bi bi-clock"></i> {{formatDateTime this.created_at}}
                  </small>
                </div>
              </div>
            {{/each}}
          </div>
        </div>
      </div>

      <!-- Action Buttons Card -->
      <div class="card shadow-sm border-0">
        <div class="card-header bg-light">
          <h5 class="mb-0">
            <i class="bi bi-gear"></i> Thao tác
          </h5>
        </div>
        <div class="card-body d-flex flex-column gap-2">
          {{#if (eq order.status_id "1")}}
            <button
              class="btn btn-danger btn-order-cancel w-100"
              data-id="{{order.id}}"
            >
              <i class="bi bi-x-circle"></i> Hủy đơn hàng
            </button>
          {{else}}
            <button class="btn btn-secondary w-100" disabled>
              <i class="bi bi-x-circle"></i> Không thể hủy
            </button>
          {{/if}}
          
          <a href="/account/orders" class="btn btn-outline-primary w-100">
            <i class="bi bi-arrow-left"></i> Quay lại danh sách
          </a>
          
          <button class="btn btn-outline-secondary w-100" onclick="window.print()">
            <i class="bi bi-printer"></i> In đơn hàng
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="/js/admin/common-modal.js"></script>
<script src="/js/client/order.js"></script>